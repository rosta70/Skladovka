<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Evidence skladové zakázky</title>
    <style>
        /* Ponecháme stejný CSS */
        body {
            margin: 0;
            padding: 20px;
        }
        
        .tabulky-container {
            position: relative;
            margin-top: 20px;
        }
        
        .zakazka-sekce {
            position: absolute;
            left: 0;
            top: 0;
            width: 15ch;
            z-index: 2;
        }
        
        .hlavni-sekce {
            margin-left: 15ch;
            position: relative;
            z-index: 1;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            box-sizing: border-box;
            height: 30px;
        }
        
        .hlavni-tabulka th, .hlavni-tabulka td {
            width: 15ch;
            max-width: 15ch;
            overflow: hidden;
            font-size: 12px;
        }
        
        .misto-sloupec {
            width: 9ch !important;
            max-width: 9ch !important;
        }
        
        .kusy-sloupec {
            width: 10ch !important;
            max-width: 10ch !important;
        }
        
        .soucet-kusu {
            width: 10ch !important;
            max-width: 10ch !important;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        input {
            width: 100%;
            box-sizing: border-box;
            border: none;
            background: transparent;
            height: 24px;
        }
        
        input:focus {
            outline: 2px solid #4CAF50;
        }
        
        input.readonly {
            background-color: #f2f2f2;
            color: #666;
        }
        
        .zakazka-textarea {
            width: 100%;
            height: 40px;
            resize: none;
            overflow: hidden;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            line-height: 1.2;
            padding: 2px;
            box-sizing: border-box;
        }
        
        .zakazka-textarea:focus {
            outline: 2px solid #4CAF50;
        }
        
        .zakazka-header {
            width: 100%;
            height: 40px;
            resize: none;
            overflow: hidden;
            border: none;
            background: #f2f2f2;
            font-family: inherit;
            font-size: inherit;
            font-weight: bold;
            line-height: 1.2;
            padding: 2px;
            box-sizing: border-box;
            text-align: center;
        }
        
        .zakazka-header:focus {
            outline: 2px solid #4CAF50;
        }
        
        .zakazka-tabulka td, .zakazka-tabulka th {
            height: 50px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
            margin-right: 10px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button.danger {
            background-color: #f44336;
        }
        
        button.danger:hover {
            background-color: #d32f2f;
        }
        
        .akce-bunka {
            width: auto !important;
            background-color: #f2f2f2;
        }
        
        .ovladaci-prvky {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .sekce-ovladani {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .dialog-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .dialog {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 500px;
            width: 90%;
        }
        
        .dialog h3 {
            margin-top: 0;
        }
        
        .dialog-tlacitka {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            @page {
                size: landscape;
            }
            
            body * {
                visibility: hidden;
            }
            
            .tabulky-container, .tabulky-container * {
                visibility: visible;
            }
            
            .tabulky-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            button, .akce-bunka, input[type="button"] {
                display: none !important;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
            }
            
            th, td {
                border: 1px solid black;
            }
        }
        
        .tlacitko-radek {
            background-color: #f2f2f2;
            text-align: center;
        }
        
        .tlacitko-radek td {
            border: none;
            padding: 5px;
        }
        
        .pridat-radek-btn {
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .pridat-radek-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h2>Evidence skladových zakázek</h2>
    
    <div class="sekce-ovladani no-print">
        <h3>Základní ovládání</h3>
        <div class="ovladaci-prvky">
            <button id="pridatZakazkuBtn">Přidat zakázku</button>
            <button id="pridatHlavniRadekBtn">Přidat řádek dat</button>
            <button id="vymazatDataBtn" class="danger">Vymazat všechna data</button>
            <button id="tiskTabulkyBtn">Tisknout tabulku</button>
        </div>
    </div>
    
    <div class="sekce-ovladani no-print">
        <h3>Správa dat</h3>
        <div class="ovladaci-prvky">
            <button id="ulozitJSONBtn">Uložit data do souboru</button>
            <input type="text" id="nazevSouboruInput" placeholder="Název souboru (volitelné)" style="max-width: 200px;">
            <button id="nacistZeSouboruBtn">Načíst data ze souboru</button>
            <input type="file" id="importSoubor" style="display: none;" accept=".json">
        </div>
    </div>
    
    <div id="dialogVymazani" class="dialog-container" style="display: none;">
        <div class="dialog">
            <h3>Potvrdit vymazání</h3>
            <p>Opravdu chcete vymazat všechna data? Tato akce je nevratná.</p>
            <div class="dialog-tlacitka">
                <button id="zrusitVymazaniBtn">Zrušit</button>
                <button id="potvrditVymazaniBtn" class="danger">Vymazat</button>
            </div>
        </div>
    </div>
    
    <div id="statusMessage" class="status-message" style="display: none;"></div>
    
    <div class="tabulky-container">
        <div class="zakazka-sekce">
            <table class="zakazka-tabulka">
                <thead>
                    <tr>
                        <th><textarea maxlength="15" rows="2" id="zakazka-nadpis" class="zakazka-header">ZAKÁZKA</textarea></th>
                    </tr>
                </thead>
                <tbody id="zakazka-tbody"></tbody>
            </table>
        </div>
        
        <div class="hlavni-sekce">
            <table class="hlavni-tabulka">
                <thead>
                    <tr>
                        <th>TAVBA</th>
                        <th>VÁHA</th>
                        <th class="kusy-sloupec">SV</th>
                        <th class="misto-sloupec">MÍSTO</th>
                        <th>SOUČET</th>
                        <th class="soucet-kusu">SV-celkem</th>
                        <th>POZNÁMKA</th>
                        <th class="akce-bunka">AKCE</th>
                    </tr>
                </thead>
                <tbody id="hlavni-tbody"></tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Počítadla řádků
        let pocetZakazek = 0;
        let pocetHlavnichRadku = 0;
        
        // Konstanta pro název v localStorage
        const STORAGE_KEY = 'evidence_zakazek_data';
        
        // Proměnná pro sledování tiché aktualizace
        let tichaAktualizace = false;
        
        // Pomocné funkce pro DOM
        function $(id) {
            return document.getElementById(id);
        }
        
        // Nastavení event listenerů programově místo inline onclick
        document.addEventListener('DOMContentLoaded', function() {
            // Připojení event listenerů na tlačítka
            $('pridatZakazkuBtn').addEventListener('click', pridatZakazku);
            $('pridatHlavniRadekBtn').addEventListener('click', pridatHlavniRadek);
            $('vymazatDataBtn').addEventListener('click', zobrazitDialogVymazani);
            $('zrusitVymazaniBtn').addEventListener('click', skrytDialogVymazani);
            $('potvrditVymazaniBtn').addEventListener('click', vymazatVsechnaData);
            $('tiskTabulkyBtn').addEventListener('click', tiskTabulky);
            $('ulozitJSONBtn').addEventListener('click', ulozitJSON);
            $('nacistZeSouboruBtn').addEventListener('click', function() {
                $('importSoubor').click();
            });
            $('importSoubor').addEventListener('change', nacistZeSouboru);
            $('zakazka-nadpis').addEventListener('input', ulozitDoLocalStorage);
            
            // Inicializace
            if (localStorage.getItem(STORAGE_KEY)) {
                nacistZLocalStorage();
            } else {
                pridatZakazku();
                pridatHlavniRadek();
            }
        });
        
        // Event listener pro kliknutí na tlačítko "Smazat" v řádku
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('smazat-radek-btn')) {
                const idRadku = event.target.getAttribute('data-id');
                if (idRadku) {
                    smazatHlavniRadek(idRadku);
                }
            }
            
            if (event.target.classList.contains('pridat-radek-btn')) {
                pridatHlavniRadek();
            }
        });
        
        // Dialog funkce
        function zobrazitDialogVymazani() {
            $('dialogVymazani').style.display = 'flex';
        }
        
        function skrytDialogVymazani() {
            $('dialogVymazani').style.display = 'none';
        }
        
        // Funkce pro vymazání všech dat
        function vymazatVsechnaData() {
            try {
                localStorage.removeItem(STORAGE_KEY);
                $('zakazka-tbody').innerHTML = '';
                $('hlavni-tbody').innerHTML = '';
                $('zakazka-nadpis').value = 'ZAKÁZKA';
                pocetZakazek = 0;
                pocetHlavnichRadku = 0;
                
                // Vytvoření výchozích řádků
                tichaAktualizace = true;
                pridatZakazku();
                pridatHlavniRadek();
                tichaAktualizace = false;
                
                skrytDialogVymazani();
                zobrazitStatus('Všechna data byla vymazána', 'success');
            } catch (error) {
                console.error('Chyba při mazání dat:', error);
                zobrazitStatus('Chyba při mazání dat: ' + error.message, 'error');
            }
        }
        
        // Funkce pro přidání nové zakázky
        function pridatZakazku() {
            try {
                const tbody = $('zakazka-tbody');
                const newRow = document.createElement('tr');
                newRow.id = 'zakazka-' + pocetZakazek;
                
                newRow.innerHTML = `
                    <td><textarea maxlength="15" rows="2" placeholder="Zakázka" class="zakazka-textarea"></textarea></td>
                `;
                
                // Připojíme event listener na nově vytvořené textarea
                const textarea = newRow.querySelector('textarea');
                textarea.addEventListener('input', ulozitDoLocalStorage);
                
                tbody.appendChild(newRow);
                pocetZakazek++;
                ulozitDoLocalStorage();
            } catch (error) {
                console.error('Chyba při přidávání zakázky:', error);
                zobrazitStatus('Chyba při přidávání zakázky: ' + error.message, 'error');
            }
        }
        
        // Funkce pro přidání nového řádku v hlavní tabulce
        function pridatHlavniRadek() {
            try {
                const tbody = $('hlavni-tbody');
                const newRow = document.createElement('tr');
                const rowId = pocetHlavnichRadku;
                newRow.id = 'hlavni-' + rowId;
                
                newRow.innerHTML = `
                    <td><input type="text" placeholder="Tavba"></td>
                    <td><input type="number" placeholder="Váha" class="vaha"></td>
                    <td class="kusy-sloupec"><input type="number" placeholder="Kusy" class="kusy"></td>
                    <td class="misto-sloupec"><input type="text" placeholder="Místo"></td>
                    <td><input type="text" class="soucet readonly" readonly></td>
                    <td class="soucet-kusu"><input type="text" class="soucet-kusu-hodnota readonly" readonly></td>
                    <td><input type="text" placeholder="Poznámka"></td>
                    <td class="akce-bunka">
                        <button class="smazat-radek-btn" data-id="${rowId}">Smazat</button>
                    </td>
                `;
                
                // Připojíme event listenery na nové inputy
                const inputs = newRow.querySelectorAll('input:not(.readonly)');
                inputs.forEach(input => {
                    input.addEventListener('input', function() {
                        if (input.classList.contains('vaha') || input.classList.contains('kusy')) {
                            prepocet();
                        }
                        ulozitDoLocalStorage();
                    });
                });
                
                tbody.appendChild(newRow);
                
                // Odstraníme stávající tlačítko
                const existujiciTlacitkoRadek = $('tlacitko-radek');
                if (existujiciTlacitkoRadek) {
                    existujiciTlacitkoRadek.remove();
                }
                
                // Přidáme tlačítko na konec
                const tlacitkoRadek = document.createElement('tr');
                tlacitkoRadek.id = 'tlacitko-radek';
                tlacitkoRadek.className = 'tlacitko-radek';
                
                const pocetSloupcu = newRow.cells.length;
                
                tlacitkoRadek.innerHTML = `
                    <td colspan="${pocetSloupcu}">
                        <button class="pridat-radek-btn">+ Přidat další řádek</button>
                    </td>
                `;
                
                tbody.appendChild(tlacitkoRadek);
                
                pocetHlavnichRadku++;
                
                prepocet();
                ulozitDoLocalStorage();
            } catch (error) {
                console.error('Chyba při přidávání řádku:', error);
                zobrazitStatus('Chyba při přidávání řádku: ' + error.message, 'error');
            }
        }
        
        // Funkce pro smazání řádku
        function smazatHlavniRadek(id) {
            try {
                const radek = $('hlavni-' + id);
                if (radek) {
                    radek.remove();
                    prepocet();
                    ulozitDoLocalStorage();
                }
            } catch (error) {
                console.error('Chyba při mazání řádku:', error);
                zobrazitStatus('Chyba při mazání řádku: ' + error.message, 'error');
            }
        }
        
        // Další funkce zůstávají téměř stejné, jen přidáme error handling
        
        // Funkce pro přepočet součtů
        function prepocet() {
            try {
                const radky = document.querySelectorAll('#hlavni-tbody tr:not(#tlacitko-radek)');
                let kumulativniSoucet = 0;
                let celkemKusy = 0;
                
                radky.forEach((radek) => {
                    const vahaInput = radek.querySelector('.vaha');
                    const soucetInput = radek.querySelector('.soucet');
                    const kusyInput = radek.querySelector('.kusy');
                    const soucetKusuInput = radek.querySelector('.soucet-kusu-hodnota');
                    
                    if (vahaInput && soucetInput) {
                        const vahaHodnota = parseFloat(vahaInput.value) || 0;
                        kumulativniSoucet += vahaHodnota;
                        soucetInput.value = kumulativniSoucet.toFixed(2);
                    }
                    
                    if (kusyInput && soucetKusuInput) {
                        const kusyHodnota = parseInt(kusyInput.value) || 0;
                        celkemKusy += kusyHodnota;
                        soucetKusuInput.value = celkemKusy;
                    }
                });
            } catch (error) {
                console.error('Chyba při přepočtu:', error);
            }
        }
        
        // Funkce pro uložení do localStorage
        function ulozitDoLocalStorage() {
            try {
                const data = ziskatVsechnaData();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                
                if (!tichaAktualizace) {
                    zobrazitStatus('Data byla automaticky uložena do localStorage.', 'success');
                }
            } catch (error) {
                console.error('Chyba při ukládání dat:', error);
                if (!tichaAktualizace) {
                    zobrazitStatus('Chyba při ukládání dat: ' + error.message, 'error');
                }
            }
        }
        
        // Funkce pro načtení z localStorage
        function nacistZLocalStorage() {
            try {
                const ulozenaData = localStorage.getItem(STORAGE_KEY);
                if (ulozenaData) {
                    tichaAktualizace = true;
                    const data = JSON.parse(ulozenaData);
                    naplnitTabulky(data);
                    tichaAktualizace = false;
                    zobrazitStatus('Data byla úspěšně načtena z localStorage.', 'success');
                }
            } catch (error) {
                console.error('Chyba při načítání dat:', error);
                zobrazitStatus('Chyba při načítání dat: ' + error.message, 'error');
            }
        }
        
        // Funkce pro získání všech dat
        function ziskatVsechnaData() {
            try {
                const zakazkyRadky = document.querySelectorAll('#zakazka-tbody tr');
                const hlavniRadky = document.querySelectorAll('#hlavni-tbody tr:not(#tlacitko-radek)');
                const zakazkaNadpis = $('zakazka-nadpis').value;
                
                const zakazky = [];
                const hlavniData = [];
                
                zakazkyRadky.forEach(radek => {
                    const textarea = radek.querySelector('textarea');
                    zakazky.push(textarea.value);
                });
                
                hlavniRadky.forEach(radek => {
                    const inputs = radek.querySelectorAll('input:not(.readonly)');
                    const data = {
                        tavba: inputs[0].value,
                        vaha: inputs[1].value,
                        kusy: inputs[2].value,
                        misto: inputs[3].value,
                        poznamka: inputs[4].value
                    };
                    hlavniData.push(data);
                });
                
                return {
                    zakazkaNadpis: zakazkaNadpis,
                    zakazky: zakazky,
                    hlavniData: hlavniData
                };
            } catch (error) {
                console.error('Chyba při získávání dat:', error);
                return { zakazkaNadpis: 'ZAKÁZKA', zakazky: [], hlavniData: [] };
            }
        }
        
        // Funkce pro naplnění tabulek daty
        function naplnitTabulky(data) {
            try {
                // Vyčištění tabulek
                $('zakazka-tbody').innerHTML = '';
                $('hlavni-tbody').innerHTML = '';
                
                // Reset počítadel
                pocetZakazek = 0;
                pocetHlavnichRadku = 0;
                
                // Naplnění nadpisu zakázky
                if (data.zakazkaNadpis) {
                    $('zakazka-nadpis').value = data.zakazkaNadpis;
                }
                
                // Naplnění zakázek
                data.zakazky.forEach(zakazka => {
                    const tbody = $('zakazka-tbody');
                    const newRow = document.createElement('tr');
                    newRow.id = 'zakazka-' + pocetZakazek;
                    
                    newRow.innerHTML = `
                        <td><textarea maxlength="15" rows="2" placeholder="Zakázka" class="zakazka-textarea">${zakazka || ''}</textarea></td>
                    `;
                    
                    // Připojíme event listener
                    const textarea = newRow.querySelector('textarea');
                    textarea.addEventListener('input', ulozitDoLocalStorage);
                    
                    tbody.appendChild(newRow);
                    pocetZakazek++;
                });
                
                // Naplnění hlavní tabulky
                data.hlavniData.forEach(radekData => {
                    const tbody = $('hlavni-tbody');
                    const newRow = document.createElement('tr');
                    const rowId = pocetHlavnichRadku;
                    newRow.id = 'hlavni-' + rowId;
                    
                    newRow.innerHTML = `
                        <td><input type="text" placeholder="Tavba" value="${radekData.tavba || ''}"></td>
                        <td><input type="number" placeholder="Váha" class="vaha" value="${radekData.vaha || ''}"></td>
                        <td class="kusy-sloupec"><input type="number" placeholder="Kusy" class="kusy" value="${radekData.kusy || ''}"></td>
                        <td class="misto-sloupec"><input type="text" placeholder="Místo" value="${radekData.misto || ''}"></td>
                        <td><input type="text" class="soucet readonly" readonly></td>
                        <td class="soucet-kusu"><input type="text" class="soucet-kusu-hodnota readonly" readonly></td>
                        <td><input type="text" placeholder="Poznámka" value="${radekData.poznamka || ''}"></td>
                        <td class="akce-bunka">
                            <button class="smazat-radek-btn" data-id="${rowId}">Smazat</button>
                        </td>
                    `;
                    
                    // Připojíme event listenery
                    const inputs = newRow.querySelectorAll('input:not(.readonly)');
                    inputs.forEach(input => {
                        input.addEventListener('input', function() {
                            if (input.classList.contains('vaha') || input.classList.contains('kusy')) {
                                prepocet();
                            }
                            ulozitDoLocalStorage();
                        });
                    });
                    
                    tbody.appendChild(newRow);
                    pocetHlavnichRadku++;
                });
                
                // Přidáme tlačítko pro přidání řádku na konec
                if (document.querySelectorAll('#hlavni-tbody tr').length > 0) {
                    const tbody = $('hlavni-tbody');
                    const tlacitkoRadek = document.createElement('tr');
                    tlacitkoRadek.id = 'tlacitko-radek';
                    tlacitkoRadek.className = 'tlacitko-radek';
                    
                    const pocetSloupcu = document.querySelector('#hlavni-tbody tr').cells.length;
                    
                    tlacitkoRadek.innerHTML = `
                        <td colspan="${pocetSloupcu}">
                            <button class="pridat-radek-btn">+ Přidat další řádek</button>
                        </td>
                    `;
                    
                    tbody.appendChild(tlacitkoRadek);
                }
                
                // Přepočet součtů
                prepocet();
            } catch (error) {
                console.error('Chyba při naplňování tabulek:', error);
                zobrazitStatus('Chyba při naplňování tabulek: ' + error.message, 'error');
            }
        }
        
        // Funkce pro uložení dat do JSON souboru
        function ulozitJSON() {
            try {
                const data = ziskatVsechnaData();
                
                // Získání vlastního názvu souboru z inputu
                let nazevSouboru = $('nazevSouboruInput').value.trim();
                
                // Pokud není zadán název, použijeme hodnotu z hlavičky "ZAKÁZKA"
                if (!nazevSouboru) {
                    const zakazkaNadpis = $('zakazka-nadpis').value.trim();
                    // Pokud i hlavička je prázdná, použijeme výchozí "zakazka"
                    nazevSouboru = zakazkaNadpis ? zakazkaNadpis.replace(/\s+/g, '_') : 'zakazka';
                }
                
// Vytvoření časové značky
                const ted = new Date();
                const datumCas = ted.getFullYear() + '-' + 
                             ('0' + (ted.getMonth() + 1)).slice(-2) + '-' + 
                             ('0' + ted.getDate()).slice(-2) + '_' + 
                             ('0' + ted.getHours()).slice(-2) + '-' + 
                             ('0' + ted.getMinutes()).slice(-2) + '-' + 
                             ('0' + ted.getSeconds()).slice(-2);
                
                // Přidáme časovou značku k názvu
                nazevSouboru = nazevSouboru + '_' + datumCas;
                
                // Přidání přípony .json, pokud už není obsažena v názvu
                if (!nazevSouboru.toLowerCase().endsWith('.json')) {
                    nazevSouboru += '.json';
                }
                
                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = nazevSouboru;
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 0);
                
                zobrazitStatus('Data byla úspěšně uložena do souboru: ' + nazevSouboru + ' a také do localStorage.', 'success');
            } catch (error) {
                console.error('Chyba při ukládání dat do souboru:', error);
                zobrazitStatus('Chyba při ukládání dat do souboru: ' + error.message, 'error');
            }
        }
        
        // Funkce pro načtení dat ze souboru
        function nacistZeSouboru(event) {
            try {
                const soubor = event.target.files[0];
                if (!soubor) return;
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const obsah = e.target.result;
                        const data = JSON.parse(obsah);
                        
                        // Ověření, že data mají očekávanou strukturu
                        if (!data.zakazky || !data.hlavniData || !Array.isArray(data.zakazky) || !Array.isArray(data.hlavniData)) {
                            zobrazitStatus('Chyba: Neplatný formát dat v souboru', 'error');
                            return;
                        }
                        
                        // Naplnění tabulek daty
                        tichaAktualizace = true;
                        naplnitTabulky(data);
                        tichaAktualizace = false;
                        
                        // Uložení do localStorage
                        ulozitDoLocalStorage();
                        
                        zobrazitStatus('Data byla úspěšně načtena ze souboru: ' + soubor.name + ' a také uložena do localStorage.', 'success');
                        
                    } catch (error) {
                        console.error('Chyba při zpracování obsahu souboru:', error);
                        zobrazitStatus('Chyba při čtení souboru: ' + error.message, 'error');
                    }
                };
                
                reader.onerror = function() {
                    zobrazitStatus('Chyba při čtení souboru', 'error');
                };
                
                reader.readAsText(soubor);
                
                // Reset hodnoty input elementu pro možnost načtení stejného souboru znovu
                event.target.value = '';
            } catch (error) {
                console.error('Chyba při načítání souboru:', error);
                zobrazitStatus('Chyba při načítání souboru: ' + error.message, 'error');
            }
        }
        
        // Funkce pro zobrazení statusu
        function zobrazitStatus(zprava, typ) {
            try {
                const statusElement = $('statusMessage');
                statusElement.textContent = zprava;
                statusElement.className = 'status-message ' + typ;
                statusElement.style.display = 'block';
                
                // Automatické skrytí po 5 sekundách
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            } catch (error) {
                console.error('Chyba při zobrazování statusu:', error);
            }
        }
        
        // Funkce pro tisk tabulky
        function tiskTabulky() {
            window.print();
        }
    </script>
</body>
</html>
